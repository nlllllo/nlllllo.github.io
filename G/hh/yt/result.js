var vm=new Vue({el:"#main",data:{num:GetQueryString("nu").replace(/\W/g,""),com:GetQueryString("com").replace(/\W/g,""),selectCom:GetQueryString("com").replace(/\W/g,""),showHistory:!1,history:[],autos:[],lists:[],alllists:[],cominfo:{},desc:!0,showAll:!!coname,coname:coname,loading:!1,check:!1,isWx:!1,isBaidu:!1,showWx:!1,wxImagePath:"",errors:{message:"",title:"",type:"empty"},checkCode:{show:!1,value:""},isFinish:!1,scanable:window.scanable,fromApp:"appshare"==GetQueryString("kdfrom")||"appshare"==
GetQueryString("from")||"singlemessage"==GetQueryString("from"),officials:{},officialLoaded:!1,wxLink:""},created:function(){var a=-1!=ua.indexOf("iphone")||-1!=ua.indexOf("ipad"),b=-1!=ua.indexOf("android");this.isWx=isWechat&&(b||a);this.isBaidu=-1!=ua.indexOf("baiduboxapp");a=GetQueryString("nu");this.getCoroperation();this.isWx&&(this.wxImagePath="https://wx.kuaidi100.com/wxbuss.do?method=getWXACodeUnLimit&pagePath=pages/result/result&scene=nu="+a+"&com=weixinKuaidi100")},methods:{appGuideOnly:function(a,
b,c,d){AppGuide.dialog({title:c||"",subtitle:d||"",logtype:a,wxDisable:!0,plainBtn:b?null:{text:"\u7ee7\u7eed\u4f7f\u7528"},iosLink:"ilovegirl/express?com="+vm.com+"&num="+vm.num+"&selectIndex=0&ordersource=mweb",androidLink:"ilovegirl/query?com="+vm.com+"&num="+vm.num+"&source=op_neg",miniprogram:{path:"pages/result/result",query:{nu:vm.num,com:vm.com}},quickapp:{path:"result",query:{nu:vm.num,com:vm.com,channel:"mweb"}},showQuickApp:!b})},appGuideResult:function(){AppGuide.dialog({logtype:"mOpenResult",
plainBtn:{text:"\u7ee7\u7eed\u4f7f\u7528"},wechat:{openText:"\u6253\u5f00\u5c0f\u7a0b\u5e8f",title:"\u6253\u5f00\u5fae\u4fe1\u5feb\u9012100\u5c0f\u7a0b\u5e8f\uff0c\u67e5\u770b\u5168\u90e8\u7269\u6d41\u4fe1\u606f",hideSubtitle:!0,subtitle:"",link:this.wxLink||"weixin://dl/business/?t=2iqSjsk4xjl"}})},getWxLink:function(){request("/e-commerce/common/generate/schema",{method:"GET",data:{path:"pages/result/result",query:"openSource=H5&nu="+this.num+"&isSpread=1"},handleFail:!1,success:function(a){this.wxLink=
a.data.link||""},fail:function(){}})},isShowAll:function(){this.showAll=!0;this.isWx=!1},closeWx:function(){this.showAll=!0;this.isWx=this.showWx=!1},showCode:function(){this.isWx?this.showWx=this.showAll=!0:this.isBaidu&&window.swanInvoke({appKey:"a437DMFSxRxbWjGhwDDYlpxqIjYI2goB",path:"pages/result/result",query:{nu:this.num,com:this.com,channel:"baiduH5"}})},getHistory:function(){this.showHistory=!0;this.history=[];token?request("/apicenter/xcx.do?method=myquerylist",{success:function(a){vm.history=
a.items||[]},handleLogin:!1,handleFail:!1}):this.getLocalHistory()},getLocalHistory:function(){this.history=getStorage("queryHistoryList")||[]},toggleHistory:function(a){setTimeout(function(){this.showHistory=a}.bind(this),0);a&&this.getHistory()},validate:function(){return/^\w+$/.test(this.num)},doCheckCode:function(){4>this.checkCode.value.length?tips("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u540e\u56db\u4f4d",1500):this.query()},closeCheckCode:function(){this.getError("empty","\u67e5\u8be2\u987a\u4e30\u5355\u53f7\u9700\u8981\u9a8c\u8bc1\u624b\u673a\u53f7",
"\u8bf7\u8f93\u5165\u6536\u4ef6\u6216\u8005\u5bc4\u4ef6\u4eba\u540e\u56db\u4f4d\u624b\u673a\u53f7\u7801");this.checkCode.show=!1},historyQuery:function(a,b){this.num=a;this.com=b;this.query()},showCheckCode:function(){this.checkCode.show=!0;this.loading=!1},query:function(){var a=this;this.num&&(this.validate()?(this.lastnum&&this.lastnum!=this.num&&(this.com="",this.cominfo={name:"",tel:"",shortName:""}),this.lastnum=this.num,this.com?(this.checkCode.value=this.checkCode.value||"",this.loading=!0,
this.alllists=[],this.errors.type="",cominfo(this.com,function(b){a.cominfo.name=b.name;a.cominfo.tel=b.contactTel;a.cominfo.shortName=b.shortName}),request("/query",{timeout:2E4,data:{postid:this.num,id:1,valicode:"",temp:Math.random(),type:this.com,phone:this.checkCode.value},success:function(b){var c=new Date;[c.getFullYear(),c.getMonth(),c.getDate()].join("");vm.showList(b);"function"===typeof window.searchFinish&&setTimeout(function(){window.searchFinish(b)},0);a.doReport(a.num,a.com,1)},fail:function(b){"408"==
b.status?(a.checkCode.value&&tips("\u624b\u673a\u540e\u56db\u4f4d\u8f93\u5165\u9519\u8bef",1500),a.showCheckCode()):vm.getError("empty","\u5feb\u9012100\u67e5\u65e0\u8bb0\u5f55","\u8bf7\u6838\u5bf9\u4f60\u7684\u516c\u53f8\u548c\u5355\u53f7\u662f\u5426\u6b63\u786e");a.doReport(a.num,a.com,0)},complete:function(b){b=b.responseJSON;vm.loading=!1;"408"!=b.status&&(vm.checkCode.value="",vm.checkCode.show=!1);vm.getWxLink()},error:function(){vm.loading=!1;vm.getError("network","\u7f51\u7edc\u9519\u8bef",
"\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\uff0c\u7a0d\u540e\u5237\u65b0\u9875\u9762\u91cd\u8bd5")}})):this.auto()):tips("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5355\u53f7"))},getError:function(a,b,c){this.errors.type=a;this.errors.title=b;this.errors.message=c},auto:function(){this.loading=!0;this.autos=[{comCode:"other",name:"\u5176\u4ed6\u5feb\u9012\u516c\u53f8"}];this.com="";this.alllists=[];request("/apicenter/kdquerytools.do?method=autoComNum&text="+this.num,{error:function(){vm.loading=!1;
vm.getError("network","\u7f51\u7edc\u9519\u8bef","\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\uff0c\u7a0d\u540e\u5237\u65b0\u9875\u9762\u91cd\u8bd5")},fail:function(a){a&&a.auto&&a.auto.length?(vm.autos=a.auto.concat(vm.autos),vm.com=vm.autos[0].comCode,vm.query()):(vm.getError("none","\u5feb\u9012100\u8bc6\u522b\u4e0d\u4e86\u5355\u53f7\u7684\u516c\u53f8","\u8bf7\u6838\u5bf9\u5355\u53f7\u662f\u5426\u6b63\u786e\uff0c\u6216\u624b\u52a8\u9009\u62e9\u5feb\u9012\u516c\u53f8"),vm.loading=!1)}})},showList:function(a){this.alllists=
a.data;"FL00"===a.condition&&this.alllists.unshift({context:"\u5feb\u9012100\u53d1\u653e\u5bc4\u4ef6\u798f\u5229\uff0c\u70b9\u51fb\u7acb\u5373\u9886\u53d6!",ftime:this.alllists[0].time,type:"gift"});this.desc&&this.lists.reverse();this.showHistory=!1;this.isFinish=3==a.state||4==a.state;this.saveHistory()},saveHistory:function(){var a=getStorage("queryHistoryList")||[];if(token)request("/apicenter/xcx.do?method=savemyquery",{data:{com:this.com,nu:this.num},handleFail:!1,handleLogin:!1});else{for(var b=
0;b<a.length;b++)if(a[b].kuaidiNum==this.num&&a[b].kuaidiCom==this.com){a.splice(b,1);break}cominfo(this.com,function(c){a.unshift({kuaidiCom:this.com,kuaidiNum:this.num,comName:c.shortName,lastModify:Date.now()});a=a.slice(0,15);setStorage("queryHistoryList",a)}.bind(this))}},goDispatchCoupon:function(){location.href="https://m.kuaidi100.com/activity/dispatchCoupon.jsp?source=m_result"},scan:function(){this.scanable&&"function"==typeof window.scan?(scan(function(a){vm.com="";vm.num=a;vm.query()}),
0):isWechat&&!isMiniProgram&&"undefined"!=typeof wx?(this.com="",wx.scanQRCode({desc:"\u8bf7\u626b\u63cf\u5feb\u9012\u5355\u4e0a\u7684\u6761\u5f62\u7801",needResult:1,scanType:["qrCode","barCode"],success:function(a){a=a.resultStr.split(",");a=1<a.length?a[1]:a[0];/^\w+$/.test(a)?(vm.num=a,vm.query()):tips("\u6ca1\u6709\u626b\u5230\u6709\u6548\u7684\u5355\u53f7")},error:function(a){0<a.errMsg.indexOf("function_not_exist")&&tips("\u7248\u672c\u8fc7\u4f4e\u8bf7\u5347\u7ea7")}})):showDownload("dialog",
"indexScanDialog","\u626b\u7801\u67e5\u5feb\u9012\u66f4\u8f7b\u677e")},download:function(a){openApp(this.getAppPath(),a)},getAppPath:function(){var a="?num="+this.num+"&com="+this.com;return{ios:"kuaidi100://ilovegirl/express"+a,android:"kuaidi100://ilovegirl/query"+a}},getCoroperation:function(){request("/apicenter/kdmkt.do?method=dictItemsByCode&dictCode=HOMEPAGE_CONFING_COMLIST",{success:function(a){for(var b={},c=0,d=a.data.length;c<d;c++)b[a.data[c].itemValue]=a.data[c].itemName;vm.officials=
b},complete:function(){vm.officialLoaded=!0},handleFail:!1})},goDispathch:function(a){location.href="/mexpress/dispatch?orderSource="+a},doReport:function(a,b,c){report("send_query_stat",{sourceCode:"WAP",orderNum:a,company:b,status:c})}},computed:{historyList:function(){for(var a=[],b=0;b<this.history.length;b++)-1<this.history[b].kuaidiNum.indexOf(this.num)&&a.push(this.history[b]);return a.slice(0,15)},serviceLink:function(){return"zhongtong"==this.com?"https://kf.zto.com/?tenantId=1&channel=WEB_KUAIDI100&billCode="+
this.num:"shentong"==this.com?"https://95543.qiyukf.com/client?k=51551590dbef83c8b969e4726877a5d1&wp=1&robotShuntSwitch=1&robotId=75059&t=\u5feb\u9012100":""}},filters:{date:function(a){return a.substring(0,10).replace(/-/g,".")},time:function(a){return a.substring(11,16)},context:function(a){return a.replace(/(1\d{10})/g,'<a href="tel:$1">$1</a>')}},watch:{num:function(a){this.num=a.replace(/\s/g,"")},"checkCode.value":function(a){this.checkCode.value=a.replace(/\D/g,"").slice(0,4)},"checkCode.show":function(a){a||
(this.checkCode.value="")},desc:function(){this.lists.reverse()},alllists:function(a){this.lists=this.fromApp||!this.showAll?a.slice(0,3):a.slice(0)},showAll:function(a){this.lists=a?this.alllists.slice(0):this.alllists.slice(0,3)},selectCom:function(a){"other"==a?(sessionStorage.setItem("lastQueryNum",this.num),window.location.replace(coname?"/app/query/all.jsp?"+query:"/all/?"+query)):"auto"==a?(this.com="",this.query()):a&&(this.com=a,this.query())}},mounted:function(){({versions:function(){var a=
navigator.userAgent;return{trident:-1<a.indexOf("Trident"),presto:-1<a.indexOf("Presto"),webKit:-1<a.indexOf("AppleWebKit"),gecko:-1<a.indexOf("Gecko")&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<a.indexOf("Android")||-1<a.indexOf("Linux"),iPhone:-1<a.indexOf("iPhone"),iPad:-1<a.indexOf("iPad"),webApp:-1==a.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()}).versions.mobile&&
"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)&&(this.isWx=!0);appLogin();this.query();this.com&&cominfo(this.com,function(a){this.autos.push({comCode:a.number,name:a.shortName},{comCode:"auto",name:"\u8bc6\u522b\u5feb\u9012\u516c\u53f8"},{comCode:"other",name:"\u5176\u4ed6\u5feb\u9012\u516c\u53f8"})}.bind(this))}});